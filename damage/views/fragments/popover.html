<div class="popover-data" ng-controller="PopoverCtrl">

    <table class="table table-striped">
        <tbody>
            <tr class="information">
                <td colspan="5">ID: {{data.team[slot].unit.id}}</td>
            </tr>
            <tr class="header">
                <td ng-if="data.team[slot].unit.class.length > 2">Class</td>
                <td ng-if="data.team[slot].unit.class.length < 3">Class 1</td>
                <td ng-if="data.team[slot].unit.class.length < 3">Class 2</td>
                <td>Type</td>
                <td>Rarity</td>
                <td colspan="{{data.team[slot].unit.class.length < 3 ? 1 : 2}}">Cost</td>
            </tr>
            <tr class="information">
                <td ng-if="data.team[slot].unit.class.length > 2">{{data.team[slot].unit.class}}</td>
                <td ng-if="data.team[slot].unit.class.length < 3">{{data.team[slot].unit.class[0]}}</td>
                <td ng-if="data.team[slot].unit.class.length < 3">{{data.team[slot].unit.class[1]}}</td>
                <td>{{data.team[slot].unit.type}}</td>
                <td>
                    <i class="fa fa-star" ng-repeat="i in [ ] | range:data.team[slot].unit.stars"></i>
                </td>
                <td colspan="{{data.team[slot].unit.class.length < 3 ? 1 : 2}}">{{data.team[slot].unit.cost}}</td>
            </tr>
            <tr class="header">
                <td>HP</td>
                <td>ATK</td>
                <td>RCV</td>
                <td>CMB</td>
                <td>Slots</td>
            </tr>
            <tr class="information">
                <td>
                    {{numbers.team[slot].hp | number}}
                    {{data.team[slot].candies.hp > 0 ? ' (+' + (data.team[slot].candies.hp * 5) + ')' : ''}}
                </td>
                <td>
                    {{numbers.team[slot].atk | number}}
                    {{data.team[slot].candies.atk > 0 ? ' (+' + (data.team[slot].candies.atk* 2) + ')' : ''}}
                </td>
                <td>
                    {{numbers.team[slot].rcv | number}}
                    {{data.team[slot].candies.rcv > 0 ? ' (+' + data.team[slot].candies.rcv + ')' : ''}}
                </td>
                <td>{{data.team[slot].unit.combo}}</td>
                <td>{{data.team[slot].unit.slots}}</td>
            </tr>
            <tr class="header" ng-if="false && (data.team[slot].unit.limitHP - data.team[slot].unit.maxHP != 0 || data.team[slot].unit.limitATK - data.team[slot].unit.maxATK != 0 || data.team[slot].unit.limitRCV - data.team[slot].unit.maxRCV != 0)">
                <td>LB HP</td>
                <td>LB ATK</td>
                <td>LB RCV</td>
                <td></td>
                <td></td>
            </tr>
            <tr class="information" ng-if="false && (data.team[slot].unit.limitHP - data.team[slot].unit.maxHP != 0 || data.team[slot].unit.limitATK - data.team[slot].unit.maxATK != 0 || data.team[slot].unit.limitRCV - data.team[slot].unit.maxRCV != 0)">
                <td>
                    {{data.team[slot].unit.limitHP | number}} (+{{data.team[slot].unit.limitHP - data.team[slot].unit.maxHP | number}})
                </td>
                <td>
                    {{data.team[slot].unit.limitATK | number}} (+{{data.team[slot].unit.limitATK - data.team[slot].unit.maxATK | number}})
                </td>
                <td>
                    {{data.team[slot].unit.limitRCV | number}} (+{{data.team[slot].unit.limitRCV - data.team[slot].unit.maxRCV | number}})
                </td>
                <td></td>
                <td></td>
            </tr>
            <tr class="header" ng-if="false && (data.team[slot].unit.limitexHP - data.team[slot].unit.limitHP != 0 || data.team[slot].unit.limitexATK - data.team[slot].unit.limitATK != 0 || data.team[slot].unit.limitexRCV - data.team[slot].unit.limitRCV != 0)">
                <td>LB Ex. HP</td>
                <td>LB Ex. ATK</td>
                <td>LB Ex. RCV</td>
                <td></td>
                <td></td>
            </tr>
            <tr class="information" ng-if="false && (data.team[slot].unit.limitexHP - data.team[slot].unit.limitHP != 0 || data.team[slot].unit.limitexATK - data.team[slot].unit.limitATK != 0 || data.team[slot].unit.limitexRCV - data.team[slot].unit.limitRCV != 0)">
                <td>
                    {{data.team[slot].unit.limitexHP | number}} (+{{data.team[slot].unit.limitexHP - data.team[slot].unit.maxHP | number}})
                </td>
                <td>
                    {{data.team[slot].unit.limitexATK | number}} (+{{data.team[slot].unit.limitexATK - data.team[slot].unit.maxATK | number}})
                </td>
                <td>
                    {{data.team[slot].unit.limitexRCV | number}} (+{{data.team[slot].unit.limitexRCV - data.team[slot].unit.maxRCV | number}})
                </td>
                <td></td>
                <td></td>
            </tr>
            <tr class="header" ng-if="slot < 2">
                <td colspan="5">Captain Ability</td>
            </tr>
            <tr class="information" ng-if="slot < 2">
                <td colspan="5">
                    <!-- Regular unit with plain string captain -->
                    <div ng-if="!details.captain.character1 && !details.captain.character2 && !details.captain.combined" ng-bind-html="details.captain | decorate"></div>
                    <!-- Variant unit - character1 (e.g., 4475-1) -->
                    <div ng-if="variantType === 'character1' && details.captain.character1">
                        <strong>{{::char1.name}}:</strong>
                        <div ng-bind-html="details.captain.character1 | decorate"></div>
                    </div>
                    <!-- Variant unit - character2 (e.g., 4475-2) -->
                    <div ng-if="variantType === 'character2' && details.captain.character2">
                        <strong>{{::char2.name}}:</strong>
                        <div ng-bind-html="details.captain.character2 | decorate"></div>
                    </div>
                    <!-- Base dual/VS unit (no variant suffix) -->
                    <div ng-if="!variantType && (details.captain.character1 || details.captain.character2 || details.captain.combined)">
                        <div ng-show="details.captain.character1">
                            <strong>{{::char1.name}}:</strong>
                            <div ng-bind-html="details.captain.character1 | decorate"></div>
                        </div>
                        <div ng-show="details.captain.character2">
                            <strong>{{::char2.name}}:</strong>
                            <div ng-bind-html="details.captain.character2 | decorate"></div>
                        </div>
                        <div ng-show="details.captain.combined">
                            <strong>Combined:</strong>
                            <div ng-bind-html="details.captain.combined | decorate"></div>
                        </div>
                    </div>
                </td>
            </tr>
            <tr class="header" ng-if="slot > 1">
                <td colspan="5">Sailor Ability</td>
            </tr>
            <tr class="information" ng-if="slot > 1">
                <td colspan="5">
                    <ul>
                        <!-- Regular unit with plain string sailor -->
                        <li ng-if="!details.sailor.base && !details.sailor.base2 && !details.sailor.character1 && !details.sailor.character2 && !details.sailor.combined && !details.sailor.level1 && !details.sailor.level2 && details.sailor" ng-bind-html="details.sailor | decorate"></li>
                        <!-- Variant unit - character1 -->
                        <li ng-if="variantType === 'character1' && details.sailor.character1"><strong>{{::char1.name}}:</strong> <span ng-bind-html="details.sailor.character1 | decorate"></span></li>
                        <!-- Variant unit - character2 -->
                        <li ng-if="variantType === 'character2' && details.sailor.character2"><strong>{{::char2.name}}:</strong> <span ng-bind-html="details.sailor.character2 | decorate"></span></li>
                        <!-- Base dual/VS unit -->
                        <ng-container ng-if="!variantType">
                            <!-- Sailor base abilities -->
                            <li ng-show="details.sailor.base" ng-bind-html="details.sailor.base | decorate"></li>
                            <li ng-show="details.sailor.base2" ng-bind-html="details.sailor.base2 | decorate"></li>
                            <!-- Sailor LB levels -->
                            <li ng-show="details.sailor.level1" ng-bind-html="details.sailor.level1 | decorate"></li>
                            <li ng-show="details.sailor.level2" ng-bind-html="details.sailor.level2 | decorate"></li>
                            <!-- Dual unit sailors -->
                            <li ng-show="details.sailor.character1"><strong>{{::char1.name}}:</strong> <span ng-bind-html="details.sailor.character1 | decorate"></span></li>
                            <li ng-show="details.sailor.character2"><strong>{{::char2.name}}:</strong> <span ng-bind-html="details.sailor.character2 | decorate"></span></li>
                            <li ng-show="details.sailor.combined"><strong>Combined:</strong> <span ng-bind-html="details.sailor.combined | decorate"></span></li>
                        </ng-container>
                    </ul>
                </td>
            </tr>
            <tr class="header">
                <td colspan="5">Special: <strong class="specialName" ng-if="details.specialName">{{details.specialName}}</strong></td>
            </tr>
            <tr class="information">
                <td colspan="5">
                    <!-- Regular unit with plain string special -->
                    <div ng-if="!details.special.character1 && !details.special.character2" ng-bind-html="details.special | decorate"></div>
                    <!-- Variant unit - character1 -->
                    <div ng-if="variantType === 'character1' && details.special.character1">
                        <strong>{{::char1.name}}:</strong>
                        <div ng-bind-html="details.special.character1 | decorate"></div>
                    </div>
                    <!-- Variant unit - character2 -->
                    <div ng-if="variantType === 'character2' && details.special.character2">
                        <strong>{{::char2.name}}:</strong>
                        <div ng-bind-html="details.special.character2 | decorate"></div>
                    </div>
                    <!-- Base dual/VS unit -->
                    <div ng-if="!variantType && (details.special.character1 || details.special.character2)">
                        <div ng-show="details.special.character1">
                            <strong>{{::char1.name}}:</strong>
                            <div ng-bind-html="details.special.character1 | decorate"></div>
                        </div>
                        <div ng-show="details.special.character2">
                            <strong>{{::char2.name}}:</strong>
                            <div ng-bind-html="details.special.character2 | decorate"></div>
                        </div>
                    </div>
                    <div class="cooldown" ng-if="details.special && cooldown">
                        {{cooldown.length ? cooldown[0] : cooldown}} turns
                        {{(cooldown.length ? ' (Max: ' + cooldown[1] + ' turns' : '')+(data.team[slot].unit.limitCD != 0 ? ', LB: ' + (cooldown[1]-data.team[slot].unit.limitCD) + ' turns' : '')+(data.team[slot].unit.limitexCD != 0 && data.team[slot].unit.limitexCD != data.team[slot].unit.limitCD ? ', LB+: ' + (cooldown[1]-data.team[slot].unit.limitexCD) + ' turns)' : ')')}}
                    </div>
                </td>
            </tr>
            <tr class="header" ng-if="slot < 2 && details.superSpecial">
                <td colspan="2">Super Special</td>
                <td colspan="3">Super Special Criteria</td>
            </tr>
            <tr class="information" ng-if="slot < 2 && details.superSpecial">
                <td colspan="2">
                    <!-- Regular unit with plain string superSpecial -->
                    <div ng-if="!details.superSpecial.character1 && !details.superSpecial.character2" ng-bind-html="details.superSpecial | decorate"></div>
                    <!-- Variant unit - character1 -->
                    <div ng-if="variantType === 'character1' && details.superSpecial.character1">
                        <strong>{{::char1.name}}:</strong>
                        <div ng-bind-html="details.superSpecial.character1 | decorate"></div>
                    </div>
                    <!-- Variant unit - character2 -->
                    <div ng-if="variantType === 'character2' && details.superSpecial.character2">
                        <strong>{{::char2.name}}:</strong>
                        <div ng-bind-html="details.superSpecial.character2 | decorate"></div>
                    </div>
                    <!-- Base dual/VS unit -->
                    <div ng-if="!variantType && (details.superSpecial.character1 || details.superSpecial.character2)">
                        <div ng-show="details.superSpecial.character1">
                            <strong>{{::char1.name}}:</strong>
                            <div ng-bind-html="details.superSpecial.character1 | decorate"></div>
                        </div>
                        <div ng-show="details.superSpecial.character2">
                            <strong>{{::char2.name}}:</strong>
                            <div ng-bind-html="details.superSpecial.character2 | decorate"></div>
                        </div>
                    </div>
                </td>
                <td colspan="3">
                    <div ng-bind-html="details.superSpecialCriteria | decorate"></div>
                </td>
            </tr>
            <tr class="header" ng-if="details.swap.base">
                <td colspan="2">Swap</td>
                <td colspan="3">Super Swap: {{details.swap.superTurns}} Swaps</td>
            </tr>
            <tr class="information" ng-if="details.swap.base">
                <td colspan="2">
                    <div ng-if="!details.swap.character1 && !details.swap.character2" ng-bind-html="details.swap.base | decorate"></div>
                    <!-- Variant unit - character1 -->
                    <div ng-if="variantType === 'character1' && details.swap.character1">
                        <strong>{{::char1.name}}:</strong>
                        <div ng-bind-html="details.swap.character1 | decorate"></div>
                    </div>
                    <!-- Variant unit - character2 -->
                    <div ng-if="variantType === 'character2' && details.swap.character2">
                        <strong>{{::char2.name}}:</strong>
                        <div ng-bind-html="details.swap.character2 | decorate"></div>
                    </div>
                    <!-- Base dual/VS unit -->
                    <div ng-if="!variantType && (details.swap.character1 || details.swap.character2)">
                        <div ng-show="details.swap.character1">
                            <strong>{{::char1.name}}:</strong>
                            <div ng-bind-html="details.swap.character1 | decorate"></div>
                        </div>
                        <div ng-show="details.swap.character2">
                            <strong>{{::char2.name}}:</strong>
                            <div ng-bind-html="details.swap.character2 | decorate"></div>
                        </div>
                    </div>
                </td>
                <td colspan="3">
                    <div ng-bind-html="details.swap.super | decorate"></div>
                </td>
            </tr>
            <tr class="header" ng-if="!details.swap.base && details.swap">
                <td colspan="5">Swap</td>
            </tr>
            <tr class="information" ng-if="!details.swap.base && details.swap">
                <td colspan="5">
                    <div ng-if="!details.swap.character1 && !details.swap.character2" ng-bind-html="details.swap | decorate"></div>
                    <!-- Variant unit - character1 -->
                    <div ng-if="variantType === 'character1' && details.swap.character1">
                        <strong>{{::char1.name}}:</strong>
                        <div ng-bind-html="details.swap.character1 | decorate"></div>
                    </div>
                    <!-- Variant unit - character2 -->
                    <div ng-if="variantType === 'character2' && details.swap.character2">
                        <strong>{{::char2.name}}:</strong>
                        <div ng-bind-html="details.swap.character2 | decorate"></div>
                    </div>
                    <!-- Base dual/VS unit -->
                    <div ng-if="!variantType && (details.swap.character1 || details.swap.character2)">
                        <div ng-show="details.swap.character1">
                            <strong>{{::char1.name}}:</strong>
                            <div ng-bind-html="details.swap.character1 | decorate"></div>
                        </div>
                        <div ng-show="details.swap.character2">
                            <strong>{{::char2.name}}:</strong>
                            <div ng-bind-html="details.swap.character2 | decorate"></div>
                        </div>
                    </div>
                </td>
            </tr>
            <!--Show Potential and Support Abilities if it can work -->
        </tbody>
    </table>

</div>